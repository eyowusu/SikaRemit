# PayGlobe Render.com Deployment Guide

## Overview
This guide walks you through deploying the complete PayGlobe application (Django backend + Next.js frontend) to Render.com.

## Prerequisites
- Render.com account
- GitHub repository with the PayGlobe codebase
- Basic familiarity with Render's dashboard

## Deployment Steps

### 1. Connect GitHub Repository
1. Log in to [Render.com](https://render.com)
2. Click "New +" â†’ "Blueprint"
3. Connect your GitHub repository containing the PayGlobe code
4. Select the repository and click "Connect"

### 2. Deploy Infrastructure (Using render.yaml)
The `render.yaml` file in the root directory will automatically create all necessary services:

1. **PostgreSQL Database** (`payglobe-db`)
   - Type: Managed PostgreSQL
   - Plan: Starter (free tier)

2. **Redis Cache** (`payglobe-redis`)
   - Type: Managed Redis
   - Plan: Starter (free tier)

3. **Django Backend** (`payglobe-backend`)
   - Type: Web Service (Python)
   - Build Command: `pip install -r requirements.txt && python manage.py collectstatic --no-input && python manage.py migrate`
   - Start Command: `gunicorn core.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --threads 2 --worker-class gthread --worker-tmp-dir /dev/shm --max-requests 1000 --max-requests-jitter 50`

4. **Next.js Frontend** (`payglobe-frontend`)
   - Type: Web Service (Node)
   - Build Command: `npm ci && npm run build`
   - Start Command: `npm start`

5. **Celery Worker** (`payglobe-worker`)
   - Type: Background Worker (Python)
   - Start Command: `celery -A core worker --loglevel=info`

### 3. Manual Service Creation (Alternative)
If you prefer to create services manually:

#### Create PostgreSQL Database
1. Go to Render Dashboard â†’ New â†’ PostgreSQL
2. Name: `payglobe-db`
3. Plan: Starter
4. Click "Create Database"

#### Create Redis Instance
1. Go to Render Dashboard â†’ New â†’ Redis
2. Name: `payglobe-redis`
3. Plan: Starter
4. Click "Create Redis"

#### Create Django Backend Service
1. Go to Render Dashboard â†’ New â†’ Web Service
2. Connect your GitHub repo
3. Runtime: Python
4. Build Command: `pip install -r requirements.txt && python manage.py collectstatic --no-input && python manage.py migrate`
5. Start Command: `gunicorn core.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --threads 2 --worker-class gthread --worker-tmp-dir /dev/shm --max-requests 1000 --max-requests-jitter 50`
6. Add Environment Variables (see Environment Variables section below)

#### Create Next.js Frontend Service
1. Go to Render Dashboard â†’ New â†’ Web Service
2. Connect your GitHub repo
3. Runtime: Node
4. Build Command: `npm ci && npm run build`
5. Start Command: `npm start`
6. Add Environment Variables (see Environment Variables section below)

#### Create Celery Worker
1. Go to Render Dashboard â†’ New â†’ Background Worker
2. Runtime: Python
3. Build Command: `pip install -r requirements.txt`
4. Start Command: `celery -A core worker --loglevel=info`
5. Add Environment Variables (same as backend)

## Environment Variables

### Backend Service Environment Variables
```
DATABASE_URL=<auto-generated-by-render>
REDIS_URL=<auto-generated-by-render>
SECRET_KEY=<auto-generated-by-render>
DEBUG=false
DJANGO_SETTINGS_MODULE=core.settings
ALLOWED_HOSTS=<auto-populated-by-render>
CORS_ALLOWED_ORIGINS=<auto-populated-by-render>
NEXTAUTH_SECRET=<auto-generated-by-render>
ADMIN_EMAIL=admin@payglobe.com
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
```

### Frontend Service Environment Variables
```
NEXT_PUBLIC_API_URL=<auto-populated-by-render>
NEXTAUTH_SECRET=<auto-generated-by-render>
NEXTAUTH_URL=<auto-populated-by-render>
NODE_ENV=production
```

### Optional Production Variables
Add these for full production functionality:
```
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=true
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
DEFAULT_FROM_EMAIL=noreply@yourdomain.com

STRIPE_SECRET_KEY=sk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...

TWILIO_ACCOUNT_SID=AC...
TWILIO_AUTH_TOKEN=...
TWILIO_PHONE_NUMBER=+...

AFRICASTALKING_API_KEY=...
AFRICASTALKING_USERNAME=...
```

## Database Setup

### Initial Migration
The build process automatically runs migrations. To manually run migrations:

1. Go to your backend service in Render
2. Click "Shell" tab
3. Run: `python manage.py migrate`

### Create Superuser
1. In the backend service shell, run:
   ```bash
   python manage.py createsuperuser
   ```
2. Follow the prompts to create an admin user

### Load Initial Data (Optional)
```bash
python manage.py loaddata fixtures/initial_data.json
```

## Domain Configuration

### Custom Domain (Optional)
1. Go to your frontend service settings
2. Add your custom domain
3. Update DNS records as instructed
4. Update `ALLOWED_HOSTS` and `CORS_ALLOWED_ORIGINS` in backend settings if needed

## Monitoring & Logs

### Health Checks
- Backend: `https://your-backend-url.onrender.com/api/health/`
- Frontend: `https://your-frontend-url.onrender.com/`

### Viewing Logs
1. Go to each service in Render Dashboard
2. Click "Logs" tab
3. View real-time logs and historical data

## Troubleshooting

### Common Issues

#### Backend Build Failures
- Check Python version (Render uses Python 3.11)
- Ensure all dependencies are in `requirements.txt`
- Check for missing environment variables

#### Frontend Build Failures
- Ensure Node.js version compatibility
- Check for missing dependencies in `package.json`
- Verify build scripts in `package.json`

#### Database Connection Issues
- Verify `DATABASE_URL` is correctly set
- Check database credentials
- Ensure database is accessible from Render

#### CORS Issues
- Verify `CORS_ALLOWED_ORIGINS` includes your frontend URL
- Check `ALLOWED_HOSTS` in Django settings

#### Static Files Issues
- Ensure `python manage.py collectstatic` runs during build
- Check static file configuration in Django settings

### Getting Help
- Check Render's [documentation](https://docs.render.com)
- Review application logs in Render Dashboard
- Test locally with production settings before deploying

## Security Considerations

1. **Environment Variables**: Never commit secrets to version control
2. **Database Security**: Use Render's managed database with proper credentials
3. **HTTPS**: Render automatically provides SSL certificates
4. **Firewall**: Render handles firewall configuration
5. **Updates**: Keep dependencies updated for security patches

## Performance Optimization

1. **Database**: Use connection pooling and proper indexing
2. **Caching**: Redis is configured for session and cache storage
3. **Static Files**: Served efficiently through Django's static file handling
4. **CDN**: Consider using a CDN for static assets in production

## Cost Estimation

### Free Tier (Starter Plans)
- Web Services: 750 hours/month (~$0)
- PostgreSQL: 1GB storage, 512MB RAM (~$0)
- Redis: 1GB storage (~$0)
- Background Worker: 750 hours/month (~$0)

### Paid Upgrades (if needed)
- Additional compute time: $7/month per 1,000 hours
- Larger databases: $7-90/month depending on size
- Custom domains: Free with paid plans

## Post-Deployment Checklist

- [ ] Services are deployed and healthy
- [ ] Database migrations completed
- [ ] Admin user created
- [ ] Frontend can communicate with backend
- [ ] Authentication flows working
- [ ] All user roles (admin, merchant, customer) accessible
- [ ] Email notifications configured (if needed)
- [ ] Payment integrations tested (if applicable)
- [ ] Custom domain configured (optional)
- [ ] SSL certificate active
- [ ] Monitoring and alerts set up

## Next Steps

1. **Test the Application**: Access your deployed frontend and test all functionality
2. **Configure Production Settings**: Add real email, payment, and SMS providers
3. **Set Up Monitoring**: Configure error tracking (Sentry) and analytics
4. **Backup Strategy**: Set up database backups if needed
5. **Scale as Needed**: Monitor usage and upgrade plans if necessary

---

**ðŸŽ‰ Your PayGlobe application is now live on Render.com!**

For additional help, refer to the [Render Documentation](https://docs.render.com) or create an issue in your repository.
