---
- name: Configure SikaRemit Monitoring
  hosts: all
  vars:
    backup_dir: /opt/sikaremit/config_backups
  tasks:
    - name: Ensure backup directory exists
      file:
        path: "{{ backup_dir }}"
        state: directory
        mode: '0755'

    - name: Install monitoring requirements
      pip:
        name:
          - prometheus-client
          - requests

    - name: Deploy backup scripts
      copy:
        src: "../../scripts/"
        dest: "/opt/sikaremit/scripts"
        mode: '0755'

    - name: Schedule backups
      cron:
        name: "SikaRemit config backup"
        minute: "0"
        hour: "2"
        job: "cd /opt/sikaremit && ./scripts/backup_config.sh"
